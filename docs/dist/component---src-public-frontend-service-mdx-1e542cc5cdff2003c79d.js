(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{zAFW:function(e,n,t){"use strict";t.r(n),t.d(n,"_frontmatter",(function(){return l})),t.d(n,"default",(function(){return b}));var a=t("Fcif"),o=t("+I+c"),r=(t("mXGw"),t("/FXl")),c=t("TjRS"),l=(t("aD51"),{});void 0!==l&&l&&l===Object(l)&&Object.isExtensible(l)&&!l.hasOwnProperty("__filemeta")&&Object.defineProperty(l,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/public/frontend/service.mdx"}});var i={_frontmatter:l},s=c.a;function b(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(r.b)(s,Object(a.a)({},i,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"service-manager"},"Service Manager"),Object(r.b)("p",null,"Service is class instance, function or React Component to handle a pieces of your app logic."),Object(r.b)("p",null,"In phpFox, platform keeps service in a service manager called ",Object(r.b)("inlineCode",{parentName:"p"},"globalContext"),", You can not access global ",Object(r.b)("inlineCode",{parentName:"p"},"manager")," directly but via hooks or saga context instead."),Object(r.b)("p",null,"Any service passed to global service manager can be access in React component or sagas function."),Object(r.b)("p",null,"In React component:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"import {useGlobal} from '@metafox/core'\n\nconst MyComponent (){\n  const manager = useGlobal();\n  const {apiClient} =  manager\n\n  // or simplier\n  // const {apiClient} =  useGlobal();\n}\n")),Object(r.b)("p",null,"In saga component:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-ts"},"import { getContext } from 'redux-saga/effects';\n\nexport function mySagas() {\n  const { apiClient } = yield * getGlobalContext();\n}\n")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"globalContext is mutable, changed a its members will affected others later access without changed or update.")),Object(r.b)("h2",{id:"class-services"},"Class Services"),Object(r.b)("p",null,"A standard service class must have ",Object(r.b)("inlineCode",{parentName:"p"},"bootstrap")," method, DO NOT define bootstrap as arrow function."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"/**\n * @type: service\n * name: logService\n **/\n\n# file src/manager/LogService.ts\n\nimport {Manager} from '@metafox/manager'\n\ntype LogServiceProps {\n  // any property here\n}\n\nclass LogService {\n  options: LogServiceProps;\n  constructor(config: LogServiceProps){\n    this.config = LogServiceProps\n  }\n\n  bootstrap(manager: Manager){\n    // to do something here.\n    // return this or void\n  }\n  info(message: string){\n    console.log(message)\n  }\n}\n")),Object(r.b)("p",null,"Restart dev server, now you can retry service use ",Object(r.b)("inlineCode",{parentName:"p"},"useGlobal")," hook, example:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"import useGlobal from '@metafox/core';\n\nconst LoginForm (){\n  const { logService } = useGlobal();\n  logService.info('This message is passed by logService')\n}\n")),Object(r.b)("h2",{id:"configuration"},"Configuration"),Object(r.b)("p",null,"A above example, You have created a service named ",Object(r.b)("inlineCode",{parentName:"p"},"logService"),", You can pass configuration from root app by a section with the same name in ",Object(r.b)("inlineCode",{parentName:"p"},"manifest.json")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "logService": {\n    "level": "warn"\n  }\n}\n')),Object(r.b)("p",null,"Service manager will pass this configuration to LogService constructor."),Object(r.b)("p",null,"If you want ot access global configuration in LogService use ",Object(r.b)("inlineCode",{parentName:"p"},"manager.options")," accesstor."),Object(r.b)("h2",{id:"functional-service"},"Functional Service"),Object(r.b)("p",null,"Some time you would like to declare general functions which can be used anywhere in components and sagas, You also hate to declare import dependencies everywhere. You\nThe better way is inject theme into manager manager."),Object(r.b)("p",null,"This example define a function generate random string"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"export default function randomId(): string {\n  return Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(0, 5);\n}\n")),Object(r.b)("p",null,"Now, you pass it to manager"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"# file src/manager.tsx\n\nconst manager = {\n  logService: LogService,\n  randomId,\n  // other manager here\n}\n\nexport default manager\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"import {useGlobal} from '@metafox/core';\n\nconst LoginForm (){\n  const { logService, randomId } = useGlobal();\n  logService.info('This message is passed by logService')\n  logService.info('test message id:', randomId());\n}\n")),Object(r.b)("h2",{id:"react-component-service"},"React Component Service"),Object(r.b)("p",null,"In order to inject a React Component Cross module without dependencies declaration, the best way\nis inject component into global service manager using inject method"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"/**\n * @type: service\n * name: CommentList\n */\n\nexport default function CommentList() {}\n")),Object(r.b)("p",null,"declare typings"),Object(r.b)("p",null,"create ./src/module.d.ts"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"import '@metafox/core/Manager';\ndeclare module '@metafox/core/Manager' {\n  interface Manager {\n    CommentList?: React.FC<{}>;\n  }\n}\n")),Object(r.b)("p",null,"Getting CommentList from any component"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx"},"import { useGlobal } from '@metafox/core';\n\nfunction MyComponent() {\n  const { CommentList } = useGlobal();\n\n  return <CommentList />;\n}\n")),Object(r.b)("h2",{id:"core-services"},"Core Services"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"apiClient"),Object(r.b)("li",{parentName:"ul"},"usePopover"),Object(r.b)("li",{parentName:"ul"},"cookieBackend"),Object(r.b)("li",{parentName:"ul"},"normalization"),Object(r.b)("li",{parentName:"ul"},"preferenceBackend"),Object(r.b)("li",{parentName:"ul"},"dialogBackend"),Object(r.b)("li",{parentName:"ul"},"intl"),Object(r.b)("li",{parentName:"ul"},"createPageParams"),Object(r.b)("li",{parentName:"ul"},"localStore"),Object(r.b)("li",{parentName:"ul"},"compactUrl"),Object(r.b)("li",{parentName:"ul"},"slugify"),Object(r.b)("li",{parentName:"ul"},"copyToClipboard"),Object(r.b)("li",{parentName:"ul"},"useActionControl"),Object(r.b)("li",{parentName:"ul"},"useSession"),Object(r.b)("li",{parentName:"ul"},"useGetItem"),Object(r.b)("li",{parentName:"ul"},"useLoggedIn"),Object(r.b)("li",{parentName:"ul"},"useIsMobile"),Object(r.b)("li",{parentName:"ul"},"usePageParams")))}void 0!==b&&b&&b===Object(b)&&Object.isExtensible(b)&&!b.hasOwnProperty("__filemeta")&&Object.defineProperty(b,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/public/frontend/service.mdx"}}),b.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-public-frontend-service-mdx-1e542cc5cdff2003c79d.js.map